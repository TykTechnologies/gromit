# Generated by: gromit policy
# Generated on: Tue May 24 08:30:46 UTC 2022

# This workflow should only exist in master
# FIXME: propagate commits, not files

name: Sync automation

on:
  push:
    branches:
      - master
    paths:
      - ci/**
      - .github/workflows/api-tests.yml
      - .github/workflows/ui-tests.yml
      - .github/workflows/release.yml
      - .github/dependabot.yml

env:
  FILES: ""

jobs:
  sync:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        branch:
          - release-4

    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ matrix.branch }}
          token: ${{ secrets.ORG_GH_TOKEN }}

      - name: sync ${{ matrix.branch }} from master
        run: |
          git fetch origin master
          git config --local user.email "policy@gromit"
          git config --local user.name "Bender"
          for f in $FILES; do 
            git checkout --theirs origin/master -- $f || true
          done
          git commit -a -m "[CI] Syncing release automation from master"
          git push origin
          echo "::debug::${FILES} syncd for ${{ matrix.branch }}"
