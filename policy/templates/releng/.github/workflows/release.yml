# Generated by: gromit policy

# Distribution channels covered by this workflow
# - Ubuntu and Debian
# - RHEL and AL
# - docker hub
# - devenv ECR
# - Cloudsmith

name: Release

on:
  # Trigger release every monday at midnight for master CI images
  schedule:
    - cron: "0 0 * * 1"   
  pull_request:
  push:
    branches:
      - master
      - release-**
    tags:
      - 'v*'

env:
  GOPRIVATE: github.com/TykTechnologies
  
jobs:
{{- template "goreleaser" . }}

{{- if has "api-tests-suit" .Branchvals.Features }}
  {{- template "test-controller" . }}
  {{- template "api-test-init" . }}
  {{- template "api-tests" . }}
{{ end -}} {{/* if repo covered by api-tests */}}

{{- template "smoke-tests" . }}

  sbom:
    needs: goreleaser
    uses: TykTechnologies/github-actions/.github/workflows/sbom.yaml@main
    secrets:
      DEPDASH_URL: ${{`{{ secrets.DEPDASH_URL }}`}}
      DEPDASH_KEY: ${{`{{ secrets.DEPDASH_KEY }}`}}
      ORG_GH_TOKEN: ${{`{{ secrets.ORG_GH_TOKEN }}`}}
