# Generated by: gromit policy

# Check the documentation at http://goreleaser.com
# This project needs CGO_ENABLED=1 and the cross-compiler toolchains for
# - arm64
# - amd64

version: 2

{{- if eq .Name "portal"}}
before:
  hooks:
    - go mod tidy
    - ./ci/copy-framework-files.sh
{{- end}}

{{- if eq .Name "ai-studio"}}
{{- if not (has "frontend-build" .Branchvals.Features) }}
before:
  hooks:
    - |
      apt-get update && \
      apt-get install -y nodejs npm && \
      which node || echo "node not found" && \
      which npm || echo "npm not found" && \
      echo "PATH=$PATH" && \
      cd ui/admin-frontend && \
      npm ci && \
      npm run build
{{- end}}
{{- end}}

{{- template "builds" . }}

{{- if or (eq .Name "tyk") (eq .Name "tyk-analytics") (eq .Name "tyk-sync") (eq .Name "tyk-pump") }}
{{- template "dockers" . }}

{{- template "docker_manifests" . }}
{{- end }}

# This disables archives
archives:
  - formats: [ 'binary' ]
    allow_different_binary_count: true

checksum:
  disable: true

release:
  disable: true
  github:
    owner: TykTechnologies
    name: {{ .Name }}
  prerelease: auto
  draft: true
  name_template: "{{ `{{.ProjectName}}-v{{.Version}}` }}"
