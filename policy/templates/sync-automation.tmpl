# Generated by: gromit policy
# Generated on: {{ .Timestamp }}

# This workflow will silently ignore files that are missing
# Most of the time this is what we want, older repos may not have some files

name: Sync automation

on:
  push:
    branches:
      - {{ .SrcBranch }}
    paths:
    {{- range $file := .MAFiles }}
      - {{ $file }}
    {{- end }}

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          ref: {{ .SrcBranch }}
	  depth: 1

      - name: sync {{ .SrcBranch }} â†’ {{ .DestBranch }}
        run: |
          git fetch origin master
          git config --local user.email "wf-gen@tyk-ci"
          git config --local user.name "Bender"
	  {{- range $file := .MAFiles }}
          git checkout --theirs origin/{{ $.SrcBranch }} -- {{ $file }} || true
	  git add {{ $file }} || true
	  {{- end }}
          git commit -m "[CI] Syncing release automation from {{ .SrcBranch }}" -m "{{ `${{ github.event.head_commit.message }}` }}"
          git push origin
          echo "::debug::syncd from {{ .SrcBranch }} to {{ .DestBranch }}"
